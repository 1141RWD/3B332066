<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarGoäºŒæ‰‹è»Šè¡Œ | é ‚ç´šäºŒæ‰‹è»Šäº¤æ˜“å¹³å°</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --primary: #0f172a; --accent: #f97316; --text-main: #1e293b;
            --text-light: #64748b; --bg-light: #f1f5f9; --white: #ffffff;
            --success: #10b981; --danger: #ef4444;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --card-border: 1px solid #e2e8f0;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        
        body { background-color: var(--bg-light); color: var(--text-main); line-height: 1.6; padding-top: 70px; display: flex; flex-direction: column; min-height: 100vh; }

        /* --- 1. å°è¦½åˆ— --- */
        nav { 
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; 
            padding: 0 5%; height: 70px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
            display: flex; justify-content: space-between; align-items: center; 
        }

        .logo { display: flex; align-items: center; gap: 5px; cursor: pointer; height: 100%; }
        .logo img { max-height: 50px; width: auto; object-fit: contain; }

        .nav-links { display: flex; align-items: center; height: 100%; }
        .nav-links a { 
            text-decoration: none; color: var(--text-main); margin-left: 2rem; 
            font-weight: 600; font-size: 0.95rem; cursor: pointer; position: relative;
            height: 70px; display: flex; align-items: center;
        }
        .nav-links a:hover, .nav-links a.active-link { color: var(--accent); }
        .nav-links a.active-link::after { 
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: var(--accent); 
        }
        .user-menu { display: none; align-items: center; gap: 0.5rem; cursor: pointer; font-weight: bold; color: var(--primary); margin-left: 2rem; }

        /* --- 2. é¦–é  Hero èˆ‡ ä¸­å¤®ç¯©é¸ --- */
        .hero { 
            background: linear-gradient(rgba(15, 23, 42, 0.7), rgba(15, 23, 42, 0.7)), url('https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80'); 
            background-size: cover; background-position: center; 
            min-height: 500px; 
            display: flex; align-items: center; justify-content: center; 
            text-align: center; color: var(--white); margin-top: -70px; padding-top: 70px;
        }
        .hero-content { width: 100%; max-width: 900px; padding: 0 1.5rem; }
        .hero h1 { font-size: 3rem; margin-bottom: 0.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .hero p { font-size: 1.2rem; opacity: 0.9; margin-bottom: 2rem; }

        .header-search-container { width: 100%; margin: 0 auto; box-shadow: 0 10px 25px rgba(0,0,0,0.2); border-radius: 12px; }
        .search-group { display: flex; width: 100%; background: var(--white); border-radius: 12px; overflow: hidden; height: 60px; }
        
        .search-select {
            flex: 1; border: none; padding: 0 1.5rem; font-size: 1.1rem; color: var(--text-main);
            outline: none; cursor: pointer; background: transparent;
            appearance: none; -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2364748b' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 1.5rem center; background-size: 1.2em;
        }
        
        .search-divider { width: 1px; height: 50%; background-color: #e2e8f0; margin: auto 0; }
        .search-group button {
            background-color: var(--accent); color: white; border: none; padding: 0 2.5rem;
            cursor: pointer; font-weight: bold; font-size: 1.2rem; transition: background 0.2s;
        }
        .search-group button:hover { background-color: #ea580c; }

        /* --- 3. å¹³åˆ†å¼æ¨™é¡Œåˆ— --- */
        .section-header {
            background: white; padding: 1.5rem 2rem; border-radius: 16px; box-shadow: var(--shadow);
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; border: var(--card-border);
        }
        .section-title-box { display: flex; align-items: center; gap: 1rem; }
        .section-icon { width: 45px; height: 45px; background: rgba(249, 115, 22, 0.1); color: var(--accent); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .section-title { font-size: 1.5rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .section-subtitle { font-size: 0.9rem; color: var(--text-light); margin-top: 5px; font-weight: normal; }
        .section-tools { display: flex; align-items: center; gap: 1rem; background: var(--bg-light); padding: 0.5rem; border-radius: 10px; }
        .tool-search { border: none; background: transparent; padding: 0.5rem; outline: none; font-size: 1rem; width: 200px; }
        .tool-divider { width: 1px; height: 20px; background: #cbd5e1; }
        .tool-count { font-size: 0.9rem; color: var(--text-light); padding: 0 0.8rem; white-space: nowrap; }

        /* --- 4. åº•éƒ¨é å°¾ --- */
        footer {
            background-color: var(--primary); color: #fff; padding: 4rem 5% 2rem 5%; margin-top: auto;
        }
        .footer-content { display: grid; grid-template-columns: 1fr 2fr; gap: 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 2rem; margin-bottom: 2rem; }
        .footer-brand h2 { font-family: 'Arial Black', sans-serif; font-size: 2rem; margin-bottom: 1rem; color: white; }
        .footer-brand span { color: var(--accent); }
        .footer-desc { color: #94a3b8; max-width: 300px; font-size: 0.95rem; }
        .footer-contact { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; }
        .contact-col h3 { color: var(--accent); font-size: 1.1rem; margin-bottom: 1rem; }
        .contact-col p { margin-bottom: 0.8rem; color: #cbd5e1; font-size: 0.95rem; display: flex; align-items: center; gap: 10px; }
        .contact-col p i { color: var(--accent); width: 20px; text-align: center; }
        .footer-copyright { text-align: center; color: #64748b; font-size: 0.9rem; }

        /* --- å…±ç”¨æ¨£å¼ --- */
        .page-section { display: none; animation: fadeIn 0.4s ease-in-out; padding-bottom: 3rem; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1.5rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 2rem; }
        .list-layout { display: grid; grid-template-columns: 260px 1fr; gap: 2rem; }
        .btn-primary { background: var(--accent); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-outline { border: 2px solid var(--primary); background: transparent; color: var(--primary); padding: 0.5rem 1rem; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-outline:hover { background: var(--primary); color: white; }
        
        .sidebar { background: white; padding: 1.5rem; border-radius: 16px; height: fit-content; box-shadow: var(--shadow); border: var(--card-border); }
        .filter-group { margin-bottom: 2rem; border-bottom: 1px solid #f1f5f9; padding-bottom: 1rem; }
        .filter-title { font-weight: bold; margin-bottom: 0.8rem; display: block; color: var(--primary); }
        .filter-item { display: flex; align-items: center; margin-bottom: 0.6rem; color: var(--text-light); cursor: pointer; transition: 0.2s; }
        .filter-item:hover { color: var(--accent); }
        .filter-item input { margin-right: 0.6rem; accent-color: var(--accent); transform: scale(1.1); }

        /* --- å¡ç‰‡æ¨£å¼ (Card) --- */
        .card { 
            background: var(--white); border-radius: 12px; overflow: hidden; 
            box-shadow: var(--shadow); transition: var(--transition); cursor: pointer; 
            display: flex; flex-direction: column; border: var(--card-border); position: relative;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15); }
        
        .card-img-wrapper { height: 220px; overflow: hidden; position: relative; }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .card:hover .card-img { transform: scale(1.05); }

        .card-actions { position: absolute; bottom: 10px; right: 10px; display: flex; gap: 5px; }
        .action-btn { 
            background: rgba(255,255,255,0.9); border: none; width: 35px; height: 35px; 
            border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; color: var(--text-light); transition: 0.2s;
        }
        /* æ”¶è—èˆ‡æ¯”è¼ƒæŒ‰éˆ•çš„æ¨£å¼ç‹€æ…‹ */
        .action-btn:hover { background: var(--accent); color: white; }
        .action-btn.active-fav { background: #fee2e2; color: #ef4444; }
        .action-btn.active-compare { background: #dbeafe; color: #2563eb; }

        .card-body { padding: 1.2rem; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 0.5rem; color: var(--text-main); }
        .card-meta { display: flex; align-items: center; gap: 10px; font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.5rem; }
        .location-tag { background: #dcfce7; color: #166534; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .card-dealer { font-size: 0.9rem; color: var(--text-light); margin-bottom: 1rem; }
        .price-row { display: flex; justify-content: space-between; align-items: flex-end; margin-top: auto; }
        .card-price { font-size: 1.5rem; font-weight: bold; color: #b91c1c; line-height: 1; }
        .card-price span { font-size: 1rem; font-weight: normal; color: #b91c1c; }
        .cert-badge { background: #e0e7ff; color: #3730a3; padding: 2px 8px; border-radius: 50px; font-size: 0.8rem; font-weight: bold; display: flex; align-items: center; gap: 3px; }

        /* Sell Page */
        .sell-container { max-width: 900px; margin: 3rem auto; background: white; padding: 4rem; border-radius: 20px; box-shadow: var(--shadow); border: var(--card-border); }
        .form-section-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 1.5rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--accent); display: inline-block; color: var(--primary); }
        .sell-form-row { display: flex; align-items: center; margin-bottom: 1.5rem; gap: 1rem; }
        .sell-form-label { width: 120px; text-align: right; font-weight: 600; color: var(--text-main); font-size: 0.95rem; }
        .sell-form-input-group { flex: 1; display: flex; gap: 1rem; align-items: center; }
        .form-control { width: 100%; padding: 0.7rem 1rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1rem; color: var(--text-main); transition: 0.2s; outline: none; }
        .form-control:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(249, 115, 22, 0.1); }
        .verify-btn { background: var(--accent); color: white; border: none; padding: 0.7rem 1.5rem; border-radius: 6px; font-weight: bold; cursor: pointer; white-space: nowrap; transition: 0.2s; }
        .verify-btn:hover { background-color: #ea580c; }
        .verify-btn:disabled { background-color: #cbd5e1; cursor: not-allowed; }
        .secure-hint { font-size: 0.85rem; color: #3b82f6; display: flex; align-items: center; gap: 5px; white-space: nowrap; }
        .unit-text { color: #ef4444; font-weight: bold; font-size: 0.9rem; white-space: nowrap; }
        .upload-area { border: 2px dashed #cbd5e1; border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; background: #f8fafc; grid-column: 1 / -1; position: relative; margin-top: 2rem; }
        .file-input-hidden { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .preview-grid { grid-column: 1 / -1; display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem; }
        .preview-img { width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; }

        /* Detail */
        .detail-layout { display: grid; grid-template-columns: 1.5fr 1fr; gap: 2rem; }
        .gallery-container { width: 100%; }
        .gallery-main { width: 100%; height: 450px; border-radius: 16px; object-fit: cover; box-shadow: var(--shadow); margin-bottom: 1rem; cursor: pointer; transition: transform 0.2s; }
        .thumbnail-list { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .thumb-img { width: 80px; height: 60px; object-fit: cover; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
        .thumb-img:hover, .thumb-img.active-thumb { border-color: var(--accent); opacity: 0.8; }
        .car-specs { margin-top: 2rem; background: white; padding: 2rem; border-radius: 16px; box-shadow: var(--shadow); border: var(--card-border); }
        .specs-title { font-size: 1.5rem; margin-bottom: 1.5rem; border-left: 5px solid var(--accent); padding-left: 1rem; color: var(--primary); }
        .specs-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem 2rem; margin-bottom: 2rem; }
        .spec-item { border-left: 3px solid #e2e8f0; padding-left: 1rem; }
        .spec-label { display: block; font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.2rem; }
        .spec-value { font-size: 1.2rem; font-weight: bold; color: var(--text-main); }
        .spec-tags { display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 2rem; border-top: 1px solid #f1f5f9; padding-top: 1.5rem; }
        .tag-badge { border: 1px solid #fca5a5; color: #b91c1c; background: #fef2f2; padding: 0.5rem 1rem; border-radius: 50px; font-size: 0.9rem; font-weight: bold; display: flex; align-items: center; gap: 5px; }
        .bid-panel { background: white; padding: 2rem; border-radius: 16px; box-shadow: var(--shadow); position: sticky; top: 100px; border: var(--card-border); }
        .history-list { margin-top: 1.5rem; max-height: 200px; overflow-y: auto; background: #f8fafc; border-radius: 8px; padding: 1rem; border: 1px solid #e2e8f0; }
        .history-item { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; color: var(--text-light); }
        .history-item.is-me { color: var(--primary); font-weight: bold; background: rgba(249, 115, 22, 0.1); margin: 0 -1rem; padding: 0.5rem 1rem; border-bottom: none; }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(5px); z-index: 2000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: 0.3s; }
        .modal-overlay.open { opacity: 1; pointer-events: auto; }
        .modal-box { background: white; padding: 2.5rem; border-radius: 16px; width: 90%; max-width: 400px; transform: translateY(20px); transition: 0.3s; text-align: center; }
        /* æ¯”è¼ƒè¡¨æ ¼çš„ Modal éœ€è¦å¯¬ä¸€é» */
        .modal-box.wide-modal { max-width: 900px; width: 95%; overflow-x: auto; }
        .modal-overlay.open .modal-box { transform: translateY(0); }
        .modal-input { width: 100%; padding: 0.8rem; margin: 0.5rem 0; border: 1px solid #cbd5e1; border-radius: 8px; }

        /* --- ğŸ”¥ NEW: æ‡¸æµ®å·¥å…·åˆ— & æ¯”è¼ƒè¡¨æ ¼ ğŸ”¥ --- */
        .floating-tools { position: fixed; bottom: 30px; right: 30px; display: flex; flex-direction: column; gap: 15px; z-index: 1500; }
        .tool-btn { 
            width: 60px; height: 60px; border-radius: 50%; background: var(--primary); color: white; 
            border: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3); cursor: pointer; display: flex; 
            align-items: center; justify-content: center; font-size: 1.5rem; position: relative; transition: transform 0.2s;
        }
        .tool-btn:hover { transform: scale(1.1); background: var(--accent); }
        .badge-count { 
            position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; 
            border-radius: 50%; width: 22px; height: 22px; font-size: 0.8rem; display: flex; 
            align-items: center; justify-content: center; border: 2px solid white; font-weight: bold;
        }

        /* æ¯”è¼ƒè¡¨æ ¼æ¨£å¼ */
        .compare-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .compare-table th, .compare-table td { border: 1px solid #e2e8f0; padding: 1rem; text-align: center; min-width: 150px; }
        .compare-table th { background: #f8fafc; color: var(--text-light); font-weight: 600; text-align: left; }
        .compare-table img { width: 100px; height: 70px; object-fit: cover; border-radius: 6px; }
        .remove-compare { color: var(--danger); cursor: pointer; font-size: 1.2rem; }

        /* æ”¶è—åˆ—è¡¨æ¨£å¼ */
        .fav-list-item { display: flex; align-items: center; gap: 1rem; padding: 1rem; border-bottom: 1px solid #eee; }
        .fav-list-item img { width: 80px; height: 60px; object-fit: cover; border-radius: 6px; }
        .fav-info { flex: 1; text-align: left; }
        .fav-remove { color: var(--text-light); cursor: pointer; }
        .fav-remove:hover { color: var(--danger); }

        /* Toast é€šçŸ¥ */
        .toast-msg {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); color: white; padding: 12px 24px; border-radius: 50px;
            z-index: 3000; opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .toast-msg.show { opacity: 1; bottom: 50px; }

        @media (max-width: 768px) {
            .hero h1 { font-size: 2rem; }
            .section-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .section-tools, .tool-search { width: 100%; }
            .search-group { flex-direction: column; height: auto; }
            .search-select { height: 50px; width: 100%; border-bottom: 1px solid #f1f5f9; }
            .search-divider { display: none; }
            .search-group button { width: 100%; height: 50px; }
            .list-layout, .detail-layout, .nav-links a { display: none; }
            .nav-links #nav-login-btn, .nav-links #nav-user-menu { display: flex; margin-left: 0; }
            .sidebar { display: none; }
            .list-layout, .detail-layout, .footer-content { grid-template-columns: 1fr; }
            .specs-grid { grid-template-columns: 1fr 1fr; }
            .sell-form-row { flex-direction: column; align-items: flex-start; gap: 0.5rem; }
            .sell-form-label { text-align: left; width: 100%; }
            .sell-form-input-group { width: 100%; flex-direction: column; }
            .floating-tools { bottom: 20px; right: 20px; gap: 10px; }
            .tool-btn { width: 50px; height: 50px; font-size: 1.2rem; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="switchPage('home')">
            <img src="brand.jpg" alt="CarGo äºŒæ‰‹è»Šè¡Œ Logo">
        </div>
        <div class="nav-links">
            <a onclick="switchPage('home')" id="nav-home" class="active-link">é¦–é </a>
            <a onclick="switchPage('auction')" id="nav-auction">ç«¶æ¨™æ‹è³£</a>
            <a onclick="switchPage('buy-now')" id="nav-buy-now">å›ºå®šåƒ¹æ ¼</a>
            <a onclick="switchPage('sell')" id="nav-sell">æˆ‘è¦è³£è»Š</a>
            
            <a id="nav-login-btn" onclick="toggleLoginModal()"><i class="far fa-user"></i> ç™»å…¥</a>
            
            <div id="nav-user-menu" class="user-menu" onclick="handleLogout()">
                <i class="fas fa-user-circle" style="font-size: 1.2rem;"></i>
                <span id="nav-username">User</span>
                <span style="font-size: 0.8rem; color: #64748b; margin-left: 5px;">(ç™»å‡º)</span>
            </div>
        </div>
    </nav>

    <div id="page-home" class="page-section active">
        <header class="hero">
            <div class="hero-content">
                <h1>å°‹æ‰¾æ‚¨çš„ä¸‹ä¸€éƒ¨å¤¢å¹»åº§é§•</h1>
                <p>ç«¶æ¨™ã€ç›´è³¼ï¼Œå…¨å°æœ€é ‚ç´šçš„äºŒæ‰‹è»Šäº¤æ˜“å¹³å°</p>
                <div class="header-search-container">
                    <div class="search-group">
                        <select id="header-type" class="search-select">
                            <option value="auction">ç«¶æ¨™æ‹è³£</option>
                            <option value="fixed">å›ºå®šåƒ¹æ ¼</option>
                        </select>
                        <div class="search-divider"></div>
                        <select id="header-brand" class="search-select">
                            <option value="all">æ‰€æœ‰å» ç‰Œ</option>
                            <option value="BMW">BMW</option>
                            <option value="Mercedes">Mercedes-Benz</option>
                            <option value="Porsche">Porsche</option>
                            <option value="Tesla">Tesla</option>
                            <option value="Audi">Audi</option>
                            <option value="Lexus">Lexus</option>
                        </select>
                        <div class="search-divider"></div>
                        <select id="header-price" class="search-select">
                            <option value="all">æ‰€æœ‰é ç®—</option>
                            <option value="low">100è¬ä»¥ä¸‹</option>
                            <option value="mid">100 - 200è¬</option>
                            <option value="high">200è¬ä»¥ä¸Š</option>
                        </select>
                        <button onclick="handleHeaderSearch()">
                            æœå°‹è»Šè¼›
                        </button>
                    </div>
                </div>
            </div>
        </header>
        <div class="container">
            <h2 style="margin-bottom: 1.5rem; color: var(--primary);">ğŸš— æ‰€æœ‰å¾…å”®è»Šè¼›</h2>
            <div class="grid" id="home-all-grid"></div>
        </div>
    </div>

    <div id="page-auction" class="page-section">
        <div class="container">
            <div class="section-header">
                <div class="section-title-box">
                    <div class="section-icon"><i class="fas fa-gavel"></i></div>
                    <div>
                        <div class="section-title">ç«¶æ¨™æ‹è³£è»Šè¼›</div>
                        <div class="section-subtitle">åƒèˆ‡å³æ™‚ç«¶æ¨™ï¼Œæ¨™ä¸‹æ‚¨çš„æ„›è»Š</div>
                    </div>
                </div>
                <div class="section-tools">
                    <i class="fas fa-search" style="color:#94a3b8; padding-left: 0.5rem;"></i>
                    <input type="text" class="tool-search" id="auction-search-input" placeholder="æœå°‹è»Šæ¬¾..." oninput="applyFilters('auction')">
                    <div class="tool-divider"></div>
                    <div class="tool-count" id="auction-count">é¡¯ç¤º 0 ç­†</div>
                </div>
            </div>
            <div class="list-layout">
                <aside class="sidebar">
                    <div class="filter-group">
                        <label class="filter-title">å“ç‰Œç¯©é¸</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="BMW" onchange="applyFilters('auction')"> BMW</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="Mercedes" onchange="applyFilters('auction')"> Mercedes-Benz</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="Porsche" onchange="applyFilters('auction')"> Porsche</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="Tesla" onchange="applyFilters('auction')"> Tesla</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="Audi" onchange="applyFilters('auction')"> Audi</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="Lexus" onchange="applyFilters('auction')"> Lexus</label>
                    </div>
                    <div class="filter-group">
                        <label class="filter-title">åƒ¹æ ¼å€é–“</label>
                        <label class="filter-item"><input type="radio" name="auction-price" value="all" checked onchange="applyFilters('auction')"> å…¨éƒ¨é¡¯ç¤º</label>
                        <label class="filter-item"><input type="radio" name="auction-price" value="low" onchange="applyFilters('auction')"> 100è¬ä»¥ä¸‹</label>
                        <label class="filter-item"><input type="radio" name="auction-price" value="mid" onchange="applyFilters('auction')"> 100 - 200è¬</label>
                        <label class="filter-item"><input type="radio" name="auction-price" value="high" onchange="applyFilters('auction')"> 200è¬ä»¥ä¸Š</label>
                    </div>
                </aside>
                <div class="grid" id="auction-grid"></div>
                <div id="auction-no-result" style="display:none; text-align:center; grid-column: 2; padding: 2rem;">
                    <i class="fas fa-search" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                    <p style="color: var(--text-light);">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„è»Šè¼›</p>
                </div>
            </div>
        </div>
    </div>

    <div id="page-buy-now" class="page-section">
        <div class="container">
            <div class="section-header">
                <div class="section-title-box">
                    <div class="section-icon"><i class="fas fa-tag"></i></div>
                    <div>
                        <div class="section-title">å›ºå®šåƒ¹æ ¼è»Šè¼›</div>
                        <div class="section-subtitle">åŸå» èªè­‰ï¼Œåƒ¹æ ¼é€æ˜ç›´æ¥è³¼è²·</div>
                    </div>
                </div>
                <div class="section-tools">
                    <i class="fas fa-search" style="color:#94a3b8; padding-left: 0.5rem;"></i>
                    <input type="text" class="tool-search" id="buy-now-search-input" placeholder="æœå°‹è»Šæ¬¾..." oninput="applyFilters('fixed')">
                    <div class="tool-divider"></div>
                    <div class="tool-count" id="fixed-count">é¡¯ç¤º 0 ç­†</div>
                </div>
            </div>
            <div class="list-layout">
                <aside class="sidebar">
                    <div class="filter-group">
                        <label class="filter-title">å“ç‰Œç¯©é¸</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter-fixed" value="BMW" onchange="applyFilters('fixed')"> BMW</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter-fixed" value="Mercedes" onchange="applyFilters('fixed')"> Mercedes-Benz</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter-fixed" value="Audi" onchange="applyFilters('fixed')"> Audi</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter-fixed" value="Lexus" onchange="applyFilters('fixed')"> Lexus</label>
                    </div>
                    <div class="filter-group">
                        <label class="filter-title">åƒ¹æ ¼å€é–“</label>
                        <label class="filter-item"><input type="radio" name="fixed-price" value="all" checked onchange="applyFilters('fixed')"> å…¨éƒ¨é¡¯ç¤º</label>
                        <label class="filter-item"><input type="radio" name="fixed-price" value="low" onchange="applyFilters('fixed')"> 100è¬ä»¥ä¸‹</label>
                        <label class="filter-item"><input type="radio" name="fixed-price" value="mid" onchange="applyFilters('fixed')"> 100 - 200è¬</label>
                        <label class="filter-item"><input type="radio" name="fixed-price" value="high" onchange="applyFilters('fixed')"> 200è¬ä»¥ä¸Š</label>
                    </div>
                </aside>
                <div class="grid" id="buy-now-grid"></div>
                <div id="fixed-no-result" style="display:none; text-align:center; grid-column: 2; padding: 2rem;">
                    <i class="fas fa-search" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                    <p style="color: var(--text-light);">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„è»Šè¼›</p>
                </div>
            </div>
        </div>
    </div>

    <div id="page-sell" class="page-section">
        <div class="container">
            <div class="sell-container">
                <h2 style="text-align: center; margin-bottom: 2rem;">ç”³è«‹ä¸Šæ¶æ‚¨çš„æ„›è»Š</h2>
                
                <form onsubmit="event.preventDefault(); alert('ç”³è«‹å·²é€å‡ºï¼'); switchPage('home');">
                    <div class="form-section-title">åŸºæœ¬è³‡è¨Š</div>
                    
                    <div class="sell-form-row">
                        <label class="sell-form-label">å» ç‰Œ/è»Šæ¬¾/è»Šå‹</label>
                        <div class="sell-form-input-group">
                            <select class="form-control"><option>BMW/å¯¶é¦¬ M4</option><option>Mercedes/è³“å£« C300</option></select>
                            <select class="form-control"><option>2023æ¬¾ M4 Competition</option><option>2022æ¬¾ M4 Coupe</option></select>
                        </div>
                    </div>

                    <div class="sell-form-row">
                        <label class="sell-form-label">å‡ºå» å¹´æœˆ</label>
                        <input type="month" class="form-control" value="2013-05">
                    </div>

                    <div class="sell-form-row">
                        <label class="sell-form-label">è¡Œé§›é‡Œç¨‹</label>
                        <div style="flex: 1; display: flex; align-items: center; gap: 10px;">
                            <input type="number" class="form-control" placeholder="è¼¸å…¥é‡Œç¨‹">
                            <span class="unit-text">è¬å…¬é‡Œ</span>
                        </div>
                    </div>

                    <div class="sell-form-row">
                        <label class="sell-form-label">è»Šèº«é¡è‰²</label>
                        <select class="form-control"><option>ç™½è‰²</option><option>é»‘è‰²</option><option>éŠ€è‰²</option><option>å…¶ä»–</option></select>
                    </div>

                    <div class="form-section-title" style="margin-top: 2rem;">è¯çµ¡è³‡è¨Š</div>

                    <div class="sell-form-row">
                        <label class="sell-form-label">æ‰€åœ¨åœ°</label>
                        <select class="form-control"><option>å°åŒ—å¸‚</option><option>æ–°åŒ—å¸‚</option><option>å°ä¸­å¸‚</option><option>é«˜é›„å¸‚</option></select>
                    </div>

                    <div class="sell-form-row">
                        <label class="sell-form-label">ç¨±å‘¼</label>
                        <div class="sell-form-input-group">
                            <input type="text" class="form-control" placeholder="è«‹è¼¸å…¥">
                            <select class="form-control" style="width: 100px;"><option>å…ˆç”Ÿ</option><option>å°å§</option></select>
                        </div>
                    </div>

                    <div class="sell-form-row">
                        <label class="sell-form-label">è¡Œå‹•é›»è©±</label>
                        <div style="flex: 1; display: flex; align-items: center; gap: 10px;">
                            <input type="tel" class="form-control" placeholder="è«‹è¼¸å…¥">
                            <div class="secure-hint">
                                <i class="fas fa-shield-alt"></i> åŠ å¯†ä¿è­·ï¼Œè½‰æ¥é›»è©±è¯çµ¡
                            </div>
                        </div>
                    </div>

                    <div class="sell-form-row">
                        <label class="sell-form-label">é©—è­‰ç¢¼</label>
                        <div class="sell-form-input-group">
                            <input type="text" class="form-control" placeholder="è¼¸å…¥ç°¡è¨Šé©—è­‰ç¢¼">
                            <button type="button" class="verify-btn" onclick="sendCode(this)">ç™¼é€</button>
                        </div>
                    </div>

                    <div class="sell-form-row">
                        <label class="sell-form-label">LINE ID</label>
                        <input type="text" class="form-control" placeholder="è«‹è¼¸å…¥">
                    </div>

                    <div class="upload-area">
                        <input type="file" class="file-input-hidden" multiple accept="image/*" onchange="previewImages(event)">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                        <h4>é»æ“Šæˆ–æ‹–æ›³ç…§ç‰‡è‡³æ­¤ (å»ºè­°è‡³å°‘ 3 å¼µ)</h4>
                    </div>
                    <div class="preview-grid" id="image-preview-container"></div>

                    <div style="margin-top: 2rem;"><button type="submit" class="btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;">æäº¤ç”³è«‹</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="page-detail" class="page-section">
        <div class="container">
            <div class="back-btn" onclick="switchPage(lastViewedPage)" style="cursor: pointer; margin-bottom: 1rem;">
                <i class="fas fa-arrow-left"></i> å›åˆ°åˆ—è¡¨
            </div>
            <div class="detail-layout">
                <div class="left-col">
                    <div class="gallery-container">
                        <img id="detail-img" src="" class="gallery-main" alt="Vehicle Main Image">
                        <div class="thumbnail-list" id="thumbnail-list-el"></div>
                    </div>
                    <div class="car-specs">
                        <h2 class="specs-title">è»Šè¼›è©³ç´°è¦æ ¼èˆ‡ç‹€æ…‹</h2>
                        <div id="specs-content"></div>
                    </div>
                </div>
                <div class="right-col">
                    <div class="bid-panel">
                        <h1 id="detail-title">Car Name</h1>
                        <h2 id="detail-price" style="font-size: 2.5rem; color: var(--primary); margin-top: 1rem;">$0</h2>
                        <div id="bid-history-container" style="display:none;">
                            <p style="margin-top: 1.5rem; font-weight: bold; color: var(--text-light); font-size: 0.9rem;">æœ€è¿‘å‡ºåƒ¹ç´€éŒ„</p>
                            <div class="history-list" id="history-list-el"></div>
                        </div>
                        <button id="detail-action-btn" class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="performAction()">ç«‹å³è¡Œå‹•</button>
                        <p id="detail-bid-info" style="text-align: center; margin-top: 1rem; font-size: 0.9rem;"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="loginModal" onclick="if(event.target === this) toggleLoginModal()">
        <div class="modal-box">
            <h2 style="margin-bottom: 1rem;">æ­¡è¿å›åˆ° CarGo</h2>
            <p style="color: #64748b; margin-bottom: 1.5rem; font-size: 0.9rem;">æ¸¬è©¦å¸³è™Ÿï¼šç›´æ¥é»ç™»å…¥å³å¯</p>
            <form onsubmit="handleLogin(event)">
                <input type="text" id="login-email" class="modal-input" placeholder="é›»å­éƒµä»¶ (ä¾‹å¦‚: alex@demo.com)" required>
                <input type="password" id="login-password" class="modal-input" placeholder="å¯†ç¢¼" required>
                <button type="submit" class="btn-primary" style="width: 100%; margin-top: 1rem;">ç™»å…¥</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="favModal" onclick="if(event.target === this) document.getElementById('favModal').classList.remove('open')">
        <div class="modal-box">
            <h2 style="margin-bottom: 1rem;">æˆ‘çš„æ”¶è— â¤ï¸</h2>
            <div id="fav-list-container" style="max-height: 400px; overflow-y: auto;">
                </div>
            <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="document.getElementById('favModal').classList.remove('open')">é—œé–‰</button>
        </div>
    </div>

    <div class="modal-overlay" id="compareModal" onclick="if(event.target === this) document.getElementById('compareModal').classList.remove('open')">
        <div class="modal-box wide-modal">
            <h2 style="margin-bottom: 1rem;">è»Šè¼›è¦æ ¼æ¯”è¼ƒ âš–ï¸</h2>
            <div id="compare-table-container">
                </div>
            <button class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="document.getElementById('compareModal').classList.remove('open')">é—œé–‰</button>
        </div>
    </div>

    <div class="floating-tools">
        <button class="tool-btn" onclick="openFavModal()">
            <i class="fas fa-heart"></i>
            <span class="badge-count" id="fav-count">0</span>
        </button>
        <button class="tool-btn" onclick="openCompareModal()">
            <i class="fas fa-balance-scale"></i>
            <span class="badge-count" id="compare-count">0</span>
        </button>
    </div>

    <div id="toast" class="toast-msg">æ“ä½œæˆåŠŸï¼</div>

    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <h2>CarGo<span>äºŒæ‰‹è»Šè¡Œ</span></h2>
                <p class="footer-desc">å…¨å°æœ€å—ä¿¡è³´çš„äºŒæ‰‹è»Šäº¤æ˜“å¹³å°ï¼Œæä¾›é€æ˜çš„ç«¶æ¨™èˆ‡ç›´è³¼æœå‹™ï¼Œè®“æ‚¨è²·å¾—å®‰å¿ƒã€é–‹å¾—æ”¾å¿ƒã€‚</p>
            </div>
            <div class="footer-contact">
                <div class="contact-col">
                    <h3>è¯çµ¡æˆ‘å€‘</h3>
                    <p><i class="fas fa-phone-alt"></i> 0800-888-888</p>
                    <p><i class="fas fa-envelope"></i> peng.20050908@gmail.com</p>
                    <p><i class="fas fa-map-marker-alt"></i> å°åŒ—å¸‚ä¿¡ç¾©å€æ¾é«˜è·¯1è™Ÿ</p>
                </div>
                <div class="contact-col">
                    <h3>ç‡Ÿæ¥­æ™‚é–“</h3>
                    <p><i class="far fa-clock"></i> é€±ä¸€è‡³é€±äº”: 09:00 - 21:00</p>
                    <p><i class="far fa-clock"></i> é€±å…­è‡³é€±æ—¥: 10:00 - 18:00</p>
                    <p><i class="fas fa-tools"></i> ä¿é¤Šå» : é€±ä¸€è‡³é€±å…­ 09:00 - 18:00</p>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            &copy; 2025 CarGo äºŒæ‰‹è»Šè¡Œ. All rights reserved.
        </div>
    </footer>

    <script>
        const carDatabase = [
            { 
                id: 1, brand: "BMW", title: "2021 BMW 330i M Sport", price: 1580000, img: "330iM.jpeg", status: "auction", 
                year: "2021", mileage: "45,773", location: "å°ä¸­å¸‚", dealer: "æ±å¾·åŸå» èªè­‰",
                history: [],
                gallery: ["330iM.jpeg", "https://images.unsplash.com/photo-1556155092-490a1ba16284?auto=format&fit=crop&w=800&q=80", "https://images.unsplash.com/photo-1555215695-3004980adade?auto=format&fit=crop&w=800&q=80"],
                specs: { mileage: "45,773", color: "éµç°ç³»", type: "è½è»Š", engine: "2.0L", drive: "äºŒè¼ªå‚³å‹•", gear: "æ‰‹è‡ªæ’", fuel: "æ±½æ²¹è»Š", doors: "äº”é–€", seats: "5äººåº§" }
            },
            { 
                id: 2, brand: "Porsche", title: "2019 Porsche 911 Carrera", price: 3250000, img: "porsche911.jpg", status: "auction", 
                year: "2019", mileage: "12,000", location: "å°åŒ—å¸‚", dealer: "æ°¸æ¥­ä¿æ™‚æ·",
                history: [],
                gallery: ["porsche911.jpg", "https://images.unsplash.com/photo-1580273916550-e323be2ed5fa?auto=format&fit=crop&w=800&q=80"],
                specs: { mileage: "12,000", color: "ç™½", type: "è·‘è»Š", engine: "3.0L", drive: "å¾Œè¼ªå‚³å‹•", gear: "è‡ªæ‰‹æ’", fuel: "æ±½æ²¹", doors: "é›™é–€", seats: "4äººåº§" }
            },
            { 
                id: 3, brand: "Tesla", title: "2022 Tesla Model 3 Perf.", price: 1350000, img: "tesla.jpg", status: "auction", 
                year: "2022", mileage: "8,500", location: "æ–°ç«¹å¸‚", dealer: "Tesla Taiwan",
                history: [],
                gallery: ["tesla.jpg"],
                specs: { mileage: "8,500", color: "ç´…", type: "è½è»Š", engine: "é›»å‹•", drive: "å››è¼ªå‚³å‹•", gear: "è‡ªæ’", fuel: "ç´”é›»", doors: "å››é–€", seats: "5äººåº§" }
            },
            { 
                id: 4, brand: "Mercedes", title: "2020 Mercedes C300", price: 1450000, img: "c300.jpeg", status: "fixed", 
                year: "2020", mileage: "30,000", location: "é«˜é›„å¸‚", dealer: "ä¸­è¯è³“å£«",
                history: [], gallery: ["c300.jpeg"], specs: { mileage: "30,000", color: "é»‘", type: "è½è»Š", engine: "2.0L", drive: "å¾Œé©…", gear: "9é€Ÿæ‰‹è‡ªæ’", fuel: "æ±½æ²¹", doors: "å››é–€", seats: "5äººåº§" } 
            },
            { id: 5, brand: "Audi", title: "2018 Audi A4 S-Line", price: 980000, img: "audia4.jpg", status: "fixed", year: "2018", mileage: "68,000", location: "å°å—å¸‚", dealer: "å¥§è¿ªèªè­‰ä¸­å¤è»Š", history: [], gallery: ["audia4.jpg"], specs: { mileage: "68,000", color: "éŠ€", type: "è½è»Š", engine: "2.0L", drive: "å‰é©…", gear: "è‡ªæ‰‹æ’", fuel: "æ±½æ²¹", doors: "å››é–€", seats: "5äººåº§" } },
            { id: 6, brand: "Lexus", title: "2023 Lexus NX200", price: 1680000, img: "lexusnx200.jpg", status: "fixed", year: "2023", mileage: "5,000", location: "æ¡ƒåœ’å¸‚", dealer: "å’Œæ³°èªè­‰", history: [], gallery: ["lexusnx200.jpg"], specs: { mileage: "5,000", color: "ç™½", type: "ä¼‘æ—…è»Š", engine: "2.0L", drive: "å‰é©…", gear: "CVT", fuel: "æ±½æ²¹", doors: "äº”é–€", seats: "5äººåº§" } },
            { id: 7, brand: "BMW", title: "2015 BMW M4 Coupe", price: 2100000, img: "bmwm4.jpeg", status: "auction", year: "2015", mileage: "55,000", location: "å°ä¸­å¸‚", dealer: "ç§‘æ—è»Šæ¥­", history: [], gallery: ["bmwm4.jpeg"], specs: { mileage: "55,000", color: "é‡‘", type: "è·‘è»Š", engine: "3.0L", drive: "å¾Œé©…", gear: "M-DCT", fuel: "æ±½æ²¹", doors: "é›™é–€", seats: "4äººåº§" } },
            { id: 8, brand: "Mercedes", title: "2022 Benz G-Class", price: 6500000, img: "benzg500.jpeg", status: "fixed", year: "2022", mileage: "3,000", location: "å°åŒ—å¸‚", dealer: "å±¤å³°æ±½è»Š", history: [], gallery: ["benzg500.jpeg"], specs: { mileage: "3,000", color: "æ¶ˆå…‰é»‘", type: "è¶Šé‡è»Š", engine: "4.0L", drive: "å››é©…", gear: "9é€Ÿæ‰‹è‡ªæ’", fuel: "æ±½æ²¹", doors: "äº”é–€", seats: "5äººåº§" } }
        ];

        let lastViewedPage = 'home';
        let currentDetailCar = null;
        let currentUser = null;
        // ğŸ”¥ NEW: å„²å­˜æ”¶è—èˆ‡æ¯”è¼ƒçš„ ID
        let favorites = [];
        let compareList = [];

        window.onload = function() {
            carDatabase.forEach(car => {
                if(car.status === 'auction' && car.history.length === 0) {
                    const users = ['Alex_99', 'CarLover', 'Toyota_Fan'];
                    for (let i = 1; i <= 3; i++) {
                        let pastPrice = car.price - (i * 10000 + Math.floor(Math.random()*5000));
                        car.history.push({ user: users[i-1], price: pastPrice, isMe: false });
                    }
                }
            });
            applyFilters('auction');
            applyFilters('fixed');
            renderHomeGrid();
            updateFloatingTools(); // åˆå§‹åŒ–å·¥å…·åˆ—æ•¸å­—
        }

        // --- æ ¸å¿ƒäº’å‹•åŠŸèƒ½ ---
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        function toggleFavorite(id, e) {
            if(e) e.stopPropagation();
            if (favorites.includes(id)) {
                favorites = favorites.filter(fid => fid !== id);
                showToast("å·²å¾æ”¶è—ç§»é™¤ ğŸ’”");
            } else {
                favorites.push(id);
                showToast("å·²åŠ å…¥æ”¶è— â¤ï¸");
            }
            updateFloatingTools();
            // é‡æ–°æ¸²æŸ“ç•¶å‰ç•«é¢ä»¥æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            if(document.getElementById('page-home').classList.contains('active')) renderHomeGrid();
            else if(document.getElementById('page-auction').classList.contains('active')) applyFilters('auction');
            else if(document.getElementById('page-buy-now').classList.contains('active')) applyFilters('fixed');
        }

        function toggleCompare(id, e) {
            if(e) e.stopPropagation();
            if (compareList.includes(id)) {
                compareList = compareList.filter(cid => cid !== id);
                showToast("å·²å¾æ¯”è¼ƒæ¸…å–®ç§»é™¤");
            } else {
                if (compareList.length >= 3) {
                    alert("æœ€å¤šåªèƒ½æ¯”è¼ƒ 3 å°è»Šè¼›ï¼");
                    return;
                }
                compareList.push(id);
                showToast("å·²åŠ å…¥æ¯”è¼ƒæ¸…å–® âš–ï¸");
            }
            updateFloatingTools();
            if(document.getElementById('page-home').classList.contains('active')) renderHomeGrid();
            else if(document.getElementById('page-auction').classList.contains('active')) applyFilters('auction');
            else if(document.getElementById('page-buy-now').classList.contains('active')) applyFilters('fixed');
        }

        function updateFloatingTools() {
            document.getElementById('fav-count').innerText = favorites.length;
            document.getElementById('compare-count').innerText = compareList.length;
        }

        // --- Modal æ¸²æŸ“é‚è¼¯ ---
        function openFavModal() {
            const container = document.getElementById('fav-list-container');
            container.innerHTML = '';
            if (favorites.length === 0) {
                container.innerHTML = '<p style="text-align:center; padding:2rem; color:#999;">ç›®å‰æ²’æœ‰æ”¶è—ä»»ä½•è»Šè¼›</p>';
            } else {
                favorites.forEach(id => {
                    const car = carDatabase.find(c => c.id === id);
                    if(car) {
                        const div = document.createElement('div');
                        div.className = 'fav-list-item';
                        div.innerHTML = `
                            <img src="${car.img}">
                            <div class="fav-info">
                                <div style="font-weight:bold;">${car.title}</div>
                                <div style="color:#b91c1c;">$${Math.floor(car.price/10000)}è¬</div>
                            </div>
                            <i class="fas fa-trash fav-remove" onclick="toggleFavorite(${car.id}); openFavModal();"></i>
                        `;
                        container.appendChild(div);
                    }
                });
            }
            document.getElementById('favModal').classList.add('open');
        }

        function openCompareModal() {
            const container = document.getElementById('compare-table-container');
            container.innerHTML = '';
            if (compareList.length === 0) {
                container.innerHTML = '<p style="text-align:center; padding:2rem; color:#999;">è«‹å…ˆåŠ å…¥è»Šè¼›é€²è¡Œæ¯”è¼ƒ (æœ€å¤š3å°)</p>';
            } else {
                const cars = compareList.map(id => carDatabase.find(c => c.id === id));
                let html = '<table class="compare-table"><thead><tr><th>æ¯”è¼ƒé …ç›®</th>';
                cars.forEach(car => html += `
                    <td>
                        <img src="${car.img}"><br>
                        <div style="font-weight:bold; margin-top:5px;">${car.title}</div>
                        <div class="remove-compare" onclick="toggleCompare(${car.id}); openCompareModal();">Ã— ç§»é™¤</div>
                    </td>
                `);
                html += '</tr></thead><tbody>';
                
                const fields = [
                    { label: "åƒ¹æ ¼", key: "price", format: v => `$${(v/10000).toFixed(0)}è¬` },
                    { label: "å¹´ä»½", key: "year" },
                    { label: "é‡Œç¨‹", key: "mileage", format: v => `${v} km` },
                    { label: "åœ°é»", key: "location" },
                    { label: "å¼•æ“", key: "specs.engine" },
                    { label: "é©…å‹•", key: "specs.drive" },
                    { label: "ç‡ƒæ²¹", key: "specs.fuel" }
                ];

                fields.forEach(f => {
                    html += `<tr><th>${f.label}</th>`;
                    cars.forEach(car => {
                        let val = f.key.includes('.') ? car.specs[f.key.split('.')[1]] : car[f.key];
                        if (f.format && typeof car[f.key] === 'number') val = f.format(car[f.key]);
                        // Fix for mileage string format in database vs number logic
                        if (f.key === 'mileage') val = car.mileage + ' km'; // Simple append since data is string
                        if (f.key === 'price') val = '$' + Math.floor(car.price/10000) + 'è¬';
                        html += `<td>${val}</td>`;
                    });
                    html += `</tr>`;
                });
                
                html += '</tbody></table>';
                container.innerHTML = html;
            }
            document.getElementById('compareModal').classList.add('open');
        }

        // --- èˆŠæœ‰åŠŸèƒ½é‚è¼¯ ---
        function toggleLoginModal() {
            document.getElementById('loginModal').classList.toggle('open');
            document.getElementById('login-email').value = "alex@demo.com";
            document.getElementById('login-password').value = "123456";
        }
        function handleLogin(e) { e.preventDefault(); const email = document.getElementById('login-email').value; currentUser = { name: email.split('@')[0], email: email }; updateNavUI(); toggleLoginModal(); alert(`æ­¡è¿å›ä¾†ï¼Œ${currentUser.name}ï¼`); }
        function handleLogout() { if(confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) { currentUser = null; updateNavUI(); switchPage('home'); } }
        function updateNavUI() { const loginBtn = document.getElementById('nav-login-btn'); const userMenu = document.getElementById('nav-user-menu'); const usernameSpan = document.getElementById('nav-username'); if (currentUser) { loginBtn.style.display = 'none'; userMenu.style.display = 'flex'; usernameSpan.innerText = currentUser.name; } else { loginBtn.style.display = 'inline-block'; userMenu.style.display = 'none'; } }

        function sendCode(btn) {
            btn.disabled = true;
            let seconds = 60;
            btn.innerText = `${seconds}s å¾Œé‡ç™¼`;
            const timer = setInterval(() => {
                seconds--;
                btn.innerText = `${seconds}s å¾Œé‡ç™¼`;
                if (seconds <= 0) { clearInterval(timer); btn.disabled = false; btn.innerText = "ç™¼é€"; }
            }, 1000);
            alert("é©—è­‰ç¢¼å·²ç™¼é€è‡³æ‚¨çš„æ‰‹æ©Ÿï¼(æ¨¡æ“¬)");
        }

        function handleHeaderSearch() {
            const type = document.getElementById('header-type').value;
            const brand = document.getElementById('header-brand').value;
            const price = document.getElementById('header-price').value;
            let targetPage = type === 'fixed' ? 'buy-now' : 'auction';
            switchPage(targetPage);
            let brandClass = type === 'fixed' ? '.brand-filter-fixed' : '.brand-filter';
            let priceName = type === 'fixed' ? 'fixed-price' : 'auction-price';
            document.querySelectorAll(brandClass).forEach(cb => cb.checked = false);
            if (brand !== 'all') { const t = Array.from(document.querySelectorAll(brandClass)).find(cb => cb.value === brand); if (t) t.checked = true; }
            const r = document.querySelector(`input[name="${priceName}"][value="${price}"]`); if (r) r.checked = true;
            applyFilters(type === 'fixed' ? 'fixed' : 'auction');
        }

        function switchPage(pageId) {
            if (pageId === 'sell' && !currentUser) { alert("è«‹å…ˆç™»å…¥æœƒå“¡ï¼Œæ‰èƒ½ç”³è«‹è³£è»Šæœå‹™ã€‚"); toggleLoginModal(); return; }
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('.nav-links a').forEach(link => link.classList.remove('active-link'));
            const navLink = document.getElementById('nav-' + pageId);
            if(navLink) navLink.classList.add('active-link');
            if (pageId === 'auction') applyFilters('auction');
            if (pageId === 'buy-now') applyFilters('fixed');
            if (pageId === 'home') renderHomeGrid();
            if (pageId === 'auction' || pageId === 'buy-now') lastViewedPage = pageId;
            window.scrollTo(0, 0);
        }

        function performAction() {
            if (!currentDetailCar) return;
            if (!currentUser) { alert("è«‹å…ˆç™»å…¥æœƒå“¡æ‰èƒ½é€²è¡Œäº¤æ˜“ã€‚"); toggleLoginModal(); return; }
            if (currentDetailCar.status === 'auction') {
                currentDetailCar.price += 10000;
                currentDetailCar.history.unshift({ user: currentUser.name, price: currentDetailCar.price, isMe: true });
                updateDetailView(); alert(`å‡ºåƒ¹æˆåŠŸï¼\nç›®å‰åƒ¹æ ¼å·²æ›´æ–°ç‚º $${currentDetailCar.price.toLocaleString()}`);
            } else { alert(`å·²æ”¶åˆ°æ‚¨çš„è³¼è²·æ„é¡˜ï¼\nå°ˆå“¡å°‡è¯çµ¡ ${currentUser.name} (${currentUser.email}) é€²è¡Œå¾ŒçºŒæµç¨‹ã€‚`); }
        }

        function updateDetailView() {
            document.getElementById('detail-price').innerText = `ç¾åƒ¹ $${currentDetailCar.price.toLocaleString()}`;
            const listEl = document.getElementById('history-list-el'); listEl.innerHTML = '';
            currentDetailCar.history.forEach(record => {
                const item = document.createElement('div');
                item.className = record.isMe ? 'history-item is-me' : 'history-item';
                const displayName = record.isMe ? `${record.user} (æ‚¨)` : record.user;
                const icon = record.isMe ? '<i class="fas fa-user-circle"></i> ' : '';
                item.innerHTML = `<span>${icon}${displayName}</span><span class="${record.isMe ? 'price-up' : ''}">$${record.price.toLocaleString()}</span>`;
                listEl.appendChild(item);
            });
        }

        function changeMainImage(src) {
            document.getElementById('detail-img').src = src;
            document.querySelectorAll('.thumb-img').forEach(img => {
                img.classList.remove('active-thumb');
                if(img.src.includes(src)) img.classList.add('active-thumb');
            });
        }

        function openDetail(carId) {
            currentDetailCar = carDatabase.find(c => c.id === carId); if (!currentDetailCar) return;
            document.getElementById('detail-title').innerText = currentDetailCar.title;
            document.getElementById('detail-img').src = currentDetailCar.img;
            const thumbContainer = document.getElementById('thumbnail-list-el');
            thumbContainer.innerHTML = '';
            if (currentDetailCar.gallery && currentDetailCar.gallery.length > 0) {
                currentDetailCar.gallery.forEach((imgSrc, index) => {
                    const thumb = document.createElement('img');
                    thumb.src = imgSrc;
                    thumb.className = `thumb-img ${index === 0 ? 'active-thumb' : ''}`;
                    thumb.onclick = () => changeMainImage(imgSrc);
                    thumbContainer.appendChild(thumb);
                });
            } else {
                const thumb = document.createElement('img');
                thumb.src = currentDetailCar.img;
                thumb.className = 'thumb-img active-thumb';
                thumbContainer.appendChild(thumb);
            }
            const specs = currentDetailCar.specs || { mileage: "-", color: "-", type: "-", engine: "-", drive: "-", gear: "-", fuel: "-", doors: "-", seats: "-" };
            const specsHtml = `
                <div class="specs-grid">
                    <div class="spec-item"><span class="spec-label">ç›®å‰é‡Œç¨‹ (å…¬é‡Œ)</span><span class="spec-value">${specs.mileage}</span></div>
                    <div class="spec-item"><span class="spec-label">é¡è‰²</span><span class="spec-value">${specs.color}</span></div>
                    <div class="spec-item"><span class="spec-label">è»Šç¨®</span><span class="spec-value">${specs.type}</span></div>
                    <div class="spec-item"><span class="spec-label">æ’æ°£é‡/é¦¬åŠ›</span><span class="spec-value">${specs.engine}</span></div>
                    <div class="spec-item"><span class="spec-label">å‚³å‹•ç¨®é¡</span><span class="spec-value">${specs.drive}</span></div>
                    <div class="spec-item"><span class="spec-label">æ’æª”</span><span class="spec-value">${specs.gear}</span></div>
                    <div class="spec-item"><span class="spec-label">ç‡ƒæ²¹ç¨®é¡</span><span class="spec-value">${specs.fuel}</span></div>
                    <div class="spec-item"><span class="spec-label">è»Šé–€æ•¸</span><span class="spec-value">${specs.doors}</span></div>
                    <div class="spec-item"><span class="spec-label">ä¹˜å®¢æ•¸</span><span class="spec-value">${specs.seats}</span></div>
                </div>
                <div class="spec-tags">
                    <span class="tag-badge"><i class="fas fa-check-circle"></i> ä¸‰å¤§ä¿è­‰</span>
                    <span class="tag-badge"><i class="fas fa-shield-alt"></i> äº”å¤§ä¿å›º</span>
                    <span class="tag-badge"><i class="fas fa-tachometer-alt"></i> é‡Œç¨‹ä¿è­‰</span>
                    <span class="tag-badge"><i class="fas fa-dollar-sign"></i> å¯¦è»Šå¯¦åƒ¹</span>
                    <span class="tag-badge"><i class="fas fa-ban"></i> éè¨ˆç¨‹è»Š</span>
                </div>
            `;
            document.getElementById('specs-content').innerHTML = specsHtml;
            const actionBtn = document.getElementById('detail-action-btn'); const bidInfo = document.getElementById('detail-bid-info'); const historyContainer = document.getElementById('bid-history-container');
            if (currentDetailCar.status === 'auction') { actionBtn.innerText = 'ç«‹å³å‡ºåƒ¹ (+1è¬)'; bidInfo.innerText = `ç«¶æ¨™å°‡æ–¼ 23:59 çµæŸ`; historyContainer.style.display = 'block'; updateDetailView(); } else { document.getElementById('detail-price').innerText = `å”®åƒ¹ $${currentDetailCar.price.toLocaleString()}`; actionBtn.innerText = 'è¯çµ¡è³£å®¶ / ç«‹å³è³¼è²·'; bidInfo.innerText = `åƒ¹æ ¼å›ºå®šï¼Œéš¨æ™‚å¯æˆäº¤`; historyContainer.style.display = 'none'; }
            switchPage('detail');
        }

        // ğŸ”¥ æ›´æ–°ï¼šç”ŸæˆåŒ…å«åœ°å€ã€å¹´ä»½ã€é‡Œç¨‹ã€è»Šå•†çš„å¡ç‰‡ HTMLï¼Œä¸¦åŠ ä¸Šæ”¶è—èˆ‡æ¯”è¼ƒåŠŸèƒ½
        function createCardHTML(car) { 
            const priceInWan = Math.floor(car.price / 10000);
            const isFav = favorites.includes(car.id) ? 'active-fav' : '';
            const isCompare = compareList.includes(car.id) ? 'active-compare' : '';
            const heartIcon = favorites.includes(car.id) ? 'fas fa-heart' : 'far fa-heart';
            
            return `
                <article class="card" onclick="openDetail(${car.id})">
                    <div class="card-img-wrapper">
                        <img src="${car.img}" class="card-img">
                        <div class="card-actions">
                            <button class="action-btn ${isFav}" onclick="toggleFavorite(${car.id}, event)"><i class="${heartIcon}"></i></button>
                            <button class="action-btn ${isCompare}" onclick="toggleCompare(${car.id}, event)"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">${car.title}</h3>
                        <div class="card-meta">
                            <span class="location-tag">${car.location}</span>
                            <span>${car.year}å¹´ | ${car.mileage}å…¬é‡Œ</span>
                        </div>
                        <div class="card-dealer">${car.dealer}</div>
                        <div class="price-row">
                            <div class="card-price">${priceInWan} <span>è¬</span></div>
                            <div class="cert-badge"><i class="fas fa-certificate"></i> èªè­‰</div>
                        </div>
                    </div>
                </article>
            `; 
        }
        
        function renderHomeGrid() { document.getElementById('home-all-grid').innerHTML = carDatabase.map(createCardHTML).join(''); }
        function previewImages(event) { const c = document.getElementById('image-preview-container'); c.innerHTML = ""; if(event.target.files) Array.from(event.target.files).forEach(f=>{const r=new FileReader();r.onload=e=>{const i=document.createElement('img');i.src=e.target.result;i.className='preview-img';c.appendChild(i)};r.readAsDataURL(f)})}

        function applyFilters(type) {
            const isAuction = type === 'auction';
            const gridId = isAuction ? 'auction-grid' : 'buy-now-grid';
            const searchInputId = isAuction ? 'auction-search-input' : 'buy-now-search-input';
            const filterClass = isAuction ? '.brand-filter' : '.brand-filter-fixed';
            const priceName = isAuction ? 'auction-price' : 'fixed-price';
            const countId = isAuction ? 'auction-count' : 'fixed-count';
            const noResultId = isAuction ? 'auction-no-result' : 'fixed-no-result';
            const searchText = document.getElementById(searchInputId).value.toLowerCase();
            const checkedBrands = Array.from(document.querySelectorAll(filterClass + ':checked')).map(el => el.value);
            const priceValue = document.querySelector(`input[name="${priceName}"]:checked`).value;
            const filteredData = carDatabase.filter(car => {
                const matchType = car.status === type;
                const matchSearch = car.title.toLowerCase().includes(searchText);
                const matchBrand = checkedBrands.length === 0 || checkedBrands.includes(car.brand);
                let matchPrice = true;
                if (priceValue === 'low') matchPrice = car.price < 1000000;
                else if (priceValue === 'mid') matchPrice = car.price >= 1000000 && car.price <= 2000000;
                else if (priceValue === 'high') matchPrice = car.price > 2000000;
                return matchType && matchSearch && matchBrand && matchPrice;
            });
            document.getElementById(gridId).innerHTML = filteredData.map(createCardHTML).join('');
            document.getElementById(noResultId).style.display = filteredData.length === 0 ? "block" : "none";
            document.getElementById(countId).innerText = `é¡¯ç¤º ${filteredData.length} ç­†`;
        }
    </script>
</body>
</html>