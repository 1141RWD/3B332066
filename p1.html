<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrestigeAuto | é ‚ç´šäºŒæ‰‹è»Šäº¤æ˜“å¹³å°</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --primary: #0f172a; --accent: #f97316; --text-main: #1e293b;
            --text-light: #64748b; --bg-light: #f1f5f9; --white: #ffffff;
            --success: #10b981;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--bg-light); color: var(--text-main); line-height: 1.6; }

        /* å°è¦½åˆ— */
        nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; padding: 1rem 5%; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary); cursor: pointer; }
        .logo span { color: var(--accent); }
        .nav-links a { text-decoration: none; color: var(--text-main); margin-left: 1.5rem; font-weight: 500; transition: 0.2s; cursor: pointer; position: relative;}
        .nav-links a:hover { color: var(--accent); }
        .nav-links a.active-link { color: var(--accent); }
        .nav-links a.active-link::after { content: ''; position: absolute; bottom: -5px; left: 0; width: 100%; height: 2px; background: var(--accent); }

        /* é é¢åˆ‡æ› */
        .page-section { display: none; animation: fadeIn 0.4s ease-in-out; padding-bottom: 3rem; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å…±ç”¨å…ƒä»¶ */
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1.5rem; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }
        .btn-primary { background: var(--accent); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-outline { border: 2px solid var(--primary); background: transparent; color: var(--primary); padding: 0.5rem 1rem; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-outline:hover { background: var(--primary); color: white; }

        /* Toolbar */
        .list-header { margin-bottom: 1.5rem; }
        .list-title { font-size: 1.8rem; color: var(--primary); margin-bottom: 1rem; }
        .toolbar { background: white; padding: 1rem 1.5rem; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 1rem; }
        .search-wrapper { flex: 1; display: flex; align-items: center; background: #f1f5f9; padding: 0.6rem 1rem; border-radius: 8px; }
        .search-wrapper i { color: var(--text-light); margin-right: 0.8rem; }
        .search-wrapper input { border: none; background: transparent; width: 100%; outline: none; font-size: 1rem; color: var(--text-main); }
        .result-count { font-size: 0.9rem; color: var(--text-light); white-space: nowrap; }

        /* åˆ—è¡¨èˆ‡å´é‚Šæ¬„ */
        .list-layout { display: grid; grid-template-columns: 250px 1fr; gap: 2rem; }
        .sidebar { background: white; padding: 1.5rem; border-radius: 16px; height: fit-content; box-shadow: var(--shadow); }
        .filter-group { margin-bottom: 2rem; border-bottom: 1px solid #f1f5f9; padding-bottom: 1rem; }
        .filter-group:last-child { border-bottom: none; }
        .filter-title { font-weight: bold; margin-bottom: 0.8rem; display: block; color: var(--primary); }
        .filter-item { display: flex; align-items: center; margin-bottom: 0.6rem; color: var(--text-light); cursor: pointer; transition: 0.2s; }
        .filter-item:hover { color: var(--accent); }
        .filter-item input { margin-right: 0.6rem; accent-color: var(--accent); transform: scale(1.1); }

        /* å¡ç‰‡ */
        .card { background: var(--white); border-radius: 16px; overflow: hidden; box-shadow: var(--shadow); transition: var(--transition); cursor: pointer; display: flex; flex-direction: column;}
        .card:hover { transform: translateY(-8px); }
        .card-img-wrapper { height: 200px; overflow: hidden; position: relative; }
        .card-tag { position: absolute; top: 10px; left: 10px; background: var(--primary); color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.8rem; font-weight: 600; }
        .card-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .card-body { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; }
        .price-area { display: flex; justify-content: space-between; align-items: center; margin-top: auto; padding-top: 1rem; border-top: 1px solid #eee; }
        .bid-amount { font-size: 1.25rem; font-weight: 800; color: var(--primary); }

        /* è³£è»Šé é¢ */
        .sell-container { max-width: 800px; margin: 3rem auto; background: white; padding: 3rem; border-radius: 20px; box-shadow: var(--shadow); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--primary); }
        .form-input { width: 100%; padding: 0.8rem; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem; }
        .upload-area { border: 2px dashed #cbd5e1; border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; transition: 0.2s; background: #f8fafc; grid-column: 1 / -1; position: relative; }
        .upload-area:hover { border-color: var(--accent); background: #fff7ed; }
        .file-input-hidden { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
        .preview-grid { grid-column: 1 / -1; display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1rem; }
        .preview-img { width: 100px; height: 100px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* Hero */
        .hero { background: linear-gradient(rgba(15, 23, 42, 0.8), rgba(15, 23, 42, 0.8)), url('https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80'); background-size: cover; background-position: center; height: 400px; display: flex; align-items: center; justify-content: center; text-align: center; color: var(--white); }
        .hero-search { background: var(--white); padding: 0.5rem; border-radius: 50px; display: flex; width: 100%; max-width: 600px; margin: 2rem auto 0; }
        .hero-search input { border: none; flex: 1; padding: 1rem 1.5rem; border-radius: 50px; outline: none; font-size: 1rem; }
        .hero-search-btn { background: var(--primary); color: var(--white); border: none; padding: 0 2rem; border-radius: 50px; cursor: pointer; font-weight: bold; }

        /* è©³ç´°é  & å‡ºåƒ¹ç´€éŒ„ */
        .detail-layout { display: grid; grid-template-columns: 1.5fr 1fr; gap: 2rem; }
        .gallery-main { width: 100%; height: 450px; border-radius: 16px; object-fit: cover; box-shadow: var(--shadow); }
        .bid-panel { background: white; padding: 2rem; border-radius: 16px; box-shadow: var(--shadow); position: sticky; top: 100px; }
        
        .history-list { margin-top: 1.5rem; max-height: 200px; overflow-y: auto; background: #f8fafc; border-radius: 8px; padding: 1rem; border: 1px solid #e2e8f0; }
        .history-item { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; color: var(--text-light); }
        /* ä½¿ç”¨è€…è‡ªå·±çš„å‡ºåƒ¹æ¨£å¼ */
        .history-item.is-me { color: var(--primary); font-weight: bold; background: rgba(249, 115, 22, 0.1); margin: 0 -1rem; padding: 0.5rem 1rem; border-bottom: none; }
        .price-up { color: var(--success); font-weight: bold; }

        @media (max-width: 768px) {
            .list-layout { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .detail-layout { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo" onclick="switchPage('home')">Prestige<span>Auto</span></div>
        <div class="nav-links">
            <a onclick="switchPage('home')" id="nav-home" class="active-link">é¦–é </a>
            <a onclick="switchPage('auction')" id="nav-auction">ç«¶æ¨™æ‹è³£</a>
            <a onclick="switchPage('buy-now')" id="nav-buy-now">å›ºå®šåƒ¹æ ¼è»Šè¼›</a>
            <a onclick="switchPage('sell')" id="nav-sell">æˆ‘è¦è³£è»Š</a>
            <a onclick="alert('ç™»å…¥åŠŸèƒ½')"><i class="far fa-user"></i> ç™»å…¥</a>
        </div>
    </nav>

    <div id="page-home" class="page-section active">
        <header class="hero">
            <div style="width: 100%;">
                <h1>å°‹æ‰¾æ‚¨çš„ä¸‹ä¸€éƒ¨å¤¢å¹»åº§é§•</h1>
                <p>ç«¶æ¨™ã€ç›´è³¼ï¼Œå…¨å°æœ€é ‚ç´šçš„äºŒæ‰‹è»Šäº¤æ˜“å¹³å°</p>
                <div class="hero-search">
                    <input type="text" id="home-search-input" placeholder="è¼¸å…¥å“ç‰Œæˆ–å‹è™Ÿ (ä¾‹å¦‚: BMW)">
                    <button class="hero-search-btn" onclick="executeHomeSearch()">æœå°‹</button>
                </div>
            </div>
        </header>
        <div class="container">
            <h2 style="margin-bottom: 1.5rem; color: var(--primary);">ğŸ”¥ æœ¬é€±ç†±é–€äº¤æ˜“</h2>
            <div class="grid" id="home-featured-grid"></div>
        </div>
    </div>

    <div id="page-auction" class="page-section">
        <div class="container">
            <h2 class="list-title">ç«¶æ¨™æ‹è³£è»Šè¼›</h2>
            <div class="toolbar list-header">
                <div class="search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="auction-search-input" placeholder="æœå°‹æ‹è³£è»Šæ¬¾..." oninput="applyFilters('auction')">
                </div>
                <div class="result-count" id="auction-count">é¡¯ç¤º 0 ç­†</div>
            </div>
            <div class="list-layout">
                <aside class="sidebar">
                    <div class="filter-group">
                        <label class="filter-title">å“ç‰Œç¯©é¸</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="BMW" onchange="applyFilters('auction')"> BMW</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="Mercedes" onchange="applyFilters('auction')"> Mercedes-Benz</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="Porsche" onchange="applyFilters('auction')"> Porsche</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter" value="Tesla" onchange="applyFilters('auction')"> Tesla</label>
                    </div>
                    <div class="filter-group">
                        <label class="filter-title">åƒ¹æ ¼å€é–“</label>
                        <label class="filter-item"><input type="radio" name="auction-price" value="all" checked onchange="applyFilters('auction')"> å…¨éƒ¨é¡¯ç¤º</label>
                        <label class="filter-item"><input type="radio" name="auction-price" value="low" onchange="applyFilters('auction')"> 100è¬ä»¥ä¸‹</label>
                        <label class="filter-item"><input type="radio" name="auction-price" value="mid" onchange="applyFilters('auction')"> 100 - 200è¬</label>
                        <label class="filter-item"><input type="radio" name="auction-price" value="high" onchange="applyFilters('auction')"> 200è¬ä»¥ä¸Š</label>
                    </div>
                </aside>
                <div class="grid" id="auction-grid"></div>
                <div id="auction-no-result" style="display:none; text-align:center; grid-column: 2; padding: 2rem;">
                    <i class="fas fa-search" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                    <p style="color: var(--text-light);">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„è»Šè¼›</p>
                </div>
            </div>
        </div>
    </div>

    <div id="page-buy-now" class="page-section">
        <div class="container">
            <h2 class="list-title">å›ºå®šåƒ¹æ ¼è»Šè¼›</h2>
            <div class="toolbar list-header">
                <div class="search-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" id="buy-now-search-input" placeholder="æœå°‹ç›´è³¼è»Šæ¬¾..." oninput="applyFilters('fixed')">
                </div>
                <div class="result-count" id="fixed-count">é¡¯ç¤º 0 ç­†</div>
            </div>
            <div class="list-layout">
                <aside class="sidebar">
                    <div class="filter-group">
                        <label class="filter-title">å“ç‰Œç¯©é¸</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter-fixed" value="BMW" onchange="applyFilters('fixed')"> BMW</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter-fixed" value="Mercedes" onchange="applyFilters('fixed')"> Mercedes-Benz</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter-fixed" value="Audi" onchange="applyFilters('fixed')"> Audi</label>
                        <label class="filter-item"><input type="checkbox" class="brand-filter-fixed" value="Lexus" onchange="applyFilters('fixed')"> Lexus</label>
                    </div>
                    <div class="filter-group">
                        <label class="filter-title">åƒ¹æ ¼å€é–“</label>
                        <label class="filter-item"><input type="radio" name="fixed-price" value="all" checked onchange="applyFilters('fixed')"> å…¨éƒ¨é¡¯ç¤º</label>
                        <label class="filter-item"><input type="radio" name="fixed-price" value="low" onchange="applyFilters('fixed')"> 100è¬ä»¥ä¸‹</label>
                        <label class="filter-item"><input type="radio" name="fixed-price" value="mid" onchange="applyFilters('fixed')"> 100 - 200è¬</label>
                        <label class="filter-item"><input type="radio" name="fixed-price" value="high" onchange="applyFilters('fixed')"> 200è¬ä»¥ä¸Š</label>
                    </div>
                </aside>
                <div class="grid" id="buy-now-grid"></div>
                <div id="fixed-no-result" style="display:none; text-align:center; grid-column: 2; padding: 2rem;">
                    <i class="fas fa-search" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                    <p style="color: var(--text-light);">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„è»Šè¼›</p>
                </div>
            </div>
        </div>
    </div>

    <div id="page-sell" class="page-section">
        <div class="container">
            <div class="sell-container">
                <h2 style="text-align: center;">ç”³è«‹ä¸Šæ¶æ‚¨çš„æ„›è»Š</h2>
                <form onsubmit="event.preventDefault(); alert('ç”³è«‹å·²é€å‡ºï¼'); switchPage('home');">
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;"><label>ä¸Šæ¶æ–¹å¼é¸æ“‡</label><select class="form-input"><option>A. ç«¶æ¨™æ‹è³£</option><option>B. å›ºå®šåƒ¹æ ¼</option></select></div>
                        <div class="form-group"><label>è»Šè¼›å“ç‰Œèˆ‡å‹è™Ÿ</label><input type="text" class="form-input" placeholder="ä¾‹å¦‚ï¼šMazda 3"></div>
                        <div class="form-group"><label>é æœŸåƒ¹æ ¼</label><input type="number" class="form-input" placeholder="è¼¸å…¥é‡‘é¡"></div>
                        <div class="upload-area">
                            <input type="file" class="file-input-hidden" multiple accept="image/*" onchange="previewImages(event)">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; color: #cbd5e1; margin-bottom: 1rem;"></i>
                            <h4>é»æ“Šæˆ–æ‹–æ›³ç…§ç‰‡è‡³æ­¤</h4>
                        </div>
                        <div class="preview-grid" id="image-preview-container"></div>
                    </div>
                    <div style="margin-top: 2rem;"><button type="submit" class="btn-primary" style="width: 100%;">æäº¤ç”³è«‹</button></div>
                </form>
            </div>
        </div>
    </div>

    <div id="page-detail" class="page-section">
        <div class="container">
            <div class="back-btn" onclick="switchPage(lastViewedPage)" style="cursor: pointer; margin-bottom: 1rem;">
                <i class="fas fa-arrow-left"></i> å›åˆ°åˆ—è¡¨
            </div>
            <div class="detail-layout">
                <div class="left-col">
                    <img id="detail-img" src="" class="gallery-main">
                    <h2 style="margin-top: 2rem;">è»Šè¼›è¦æ ¼</h2>
                    <p style="color: var(--text-light);">è»Šè¼›è©³ç´°æª¢æ¸¬å ±å‘Š...</p>
                </div>
                <div class="right-col">
                    <div class="bid-panel">
                        <h1 id="detail-title">Car Name</h1>
                        <h2 id="detail-price" style="font-size: 2.5rem; color: var(--primary); margin-top: 1rem;">$0</h2>
                        
                        <div id="bid-history-container" style="display:none;">
                            <p style="margin-top: 1.5rem; font-weight: bold; color: var(--text-light); font-size: 0.9rem;">æœ€è¿‘å‡ºåƒ¹ç´€éŒ„</p>
                            <div class="history-list" id="history-list-el"></div>
                        </div>

                        <button id="detail-action-btn" class="btn-primary" style="width: 100%; margin-top: 1rem;" onclick="performAction()">ç«‹å³è¡Œå‹•</button>
                        <p id="detail-bid-info" style="text-align: center; margin-top: 1rem; font-size: 0.9rem;"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è³‡æ–™åº«ï¼šç¾åœ¨æ¯å°è»Šéƒ½å¤šäº†ä¸€å€‹ 'history' æ¬„ä½ï¼Œåˆå§‹ç‚ºç©ºé™£åˆ—
        const carDatabase = [
            { id: 1, brand: "BMW", title: "2021 BMW 330i M Sport", price: 1580000, img: "https://images.unsplash.com/photo-1555215695-3004980adade?auto=format&fit=crop&w=800&q=80", status: "auction", history: [] },
            { id: 2, brand: "Porsche", title: "2019 Porsche 911 Carrera", price: 3250000, img: "https://images.unsplash.com/photo-1503376763036-066120622c74?auto=format&fit=crop&w=800&q=80", status: "auction", history: [] },
            { id: 3, brand: "Tesla", title: "2022 Tesla Model 3 Perf.", price: 1350000, img: "https://images.unsplash.com/photo-1617788138017-80ad40651399?auto=format&fit=crop&w=800&q=80", status: "auction", history: [] },
            { id: 4, brand: "Mercedes", title: "2020 Mercedes C300", price: 1450000, img: "https://images.unsplash.com/photo-1618843479313-40f8afb4b4d8?auto=format&fit=crop&w=800&q=80", status: "fixed", history: [] },
            { id: 5, brand: "Audi", title: "2018 Audi A4 S-Line", price: 980000, img: "https://images.unsplash.com/photo-1606664515524-ed2f786a0bd6?auto=format&fit=crop&w=800&q=80", status: "fixed", history: [] },
            { id: 6, brand: "Lexus", title: "2023 Lexus NX200", price: 1680000, img: "https://images.unsplash.com/photo-1550355291-bbee04a92027?auto=format&fit=crop&w=800&q=80", status: "fixed", history: [] },
            { id: 7, brand: "BMW", title: "2015 BMW M4 Coupe", price: 2100000, img: "https://images.unsplash.com/photo-1617531653332-bd46c24f2068?auto=format&fit=crop&w=800&q=80", status: "auction", history: [] },
            { id: 8, brand: "Mercedes", title: "2022 Benz G-Class", price: 6500000, img: "https://images.unsplash.com/photo-1520031441872-265e4e9d96b5?auto=format&fit=crop&w=800&q=80", status: "fixed", history: [] }
        ];

        let lastViewedPage = 'home';
        let currentDetailCar = null;

        // --- åˆå§‹åŒ–ï¼šç”¢ç”Ÿåˆå§‹çš„å‡æ­·å²ç´€éŒ„ (åªåŸ·è¡Œä¸€æ¬¡) ---
        window.onload = function() {
            // å¹«æ‰€æœ‰æ‹è³£è»Šç”¢ç”Ÿåˆå§‹å‡è³‡æ–™ï¼Œä¸¦å­˜å…¥ car.history
            carDatabase.forEach(car => {
                if(car.status === 'auction' && car.history.length === 0) {
                    const users = ['Alex_99', 'CarLover', 'Toyota_Fan'];
                    // ç”¢ç”Ÿ 3 ç­†æ¯”åˆå§‹åƒ¹æ ¼ä½çš„ç´€éŒ„
                    for (let i = 1; i <= 3; i++) {
                        let pastPrice = car.price - (i * 10000 + Math.floor(Math.random()*5000));
                        car.history.push({
                            user: users[i-1],
                            price: pastPrice,
                            isMe: false
                        });
                    }
                }
            });

            applyFilters('auction');
            applyFilters('fixed');
            renderFeatured();
        }

        // --- æ ¸å¿ƒé‚è¼¯ï¼šå‡ºåƒ¹èˆ‡å„²å­˜ ---
        function performAction() {
            if (!currentDetailCar) return;

            if (currentDetailCar.status === 'auction') {
                // 1. åƒ¹æ ¼å¢åŠ 
                currentDetailCar.price += 10000;
                
                // 2. æ–°å¢ä¸€ç­†ç´€éŒ„åˆ°è©²è»Šçš„ history é™£åˆ—æœ€å‰é¢ (unshift)
                // é€™è£¡åŠ å…¥äº† isMe: true æ¨™è¨˜ï¼Œä»£è¡¨é€™æ˜¯ä½ å‡ºçš„
                currentDetailCar.history.unshift({
                    user: 'æ‚¨ (You)',
                    price: currentDetailCar.price,
                    isMe: true
                });

                // 3. æ›´æ–°ç•«é¢
                updateDetailView();
                alert(`å‡ºåƒ¹æˆåŠŸï¼\nç›®å‰åƒ¹æ ¼å·²æ›´æ–°ç‚º $${currentDetailCar.price.toLocaleString()}`);
            } else {
                alert(`æ­£åœ¨ç‚ºæ‚¨è½‰æ¥ ${currentDetailCar.title} çš„éŠ·å”®é¡§å•ã€‚`);
            }
        }

        // æ›´æ–°è©³ç´°é é¢çš„æ•¸æ“š (åƒ¹æ ¼ + æ­·å²ç´€éŒ„)
        function updateDetailView() {
            document.getElementById('detail-price').innerText = `ç¾åƒ¹ $${currentDetailCar.price.toLocaleString()}`;
            
            const listEl = document.getElementById('history-list-el');
            listEl.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨

            // å¾ car.history è®€å–è³‡æ–™ä¾†æ¸²æŸ“
            currentDetailCar.history.forEach(record => {
                const item = document.createElement('div');
                // å¦‚æœæ˜¯è‡ªå·±å‡ºçš„ï¼ŒåŠ ä¸Šç‰¹åˆ¥æ¨£å¼ class="is-me"
                item.className = record.isMe ? 'history-item is-me' : 'history-item';
                
                const userHtml = record.isMe ? `<span><i class="fas fa-user-circle"></i> ${record.user}</span>` : `<span>${record.user}</span>`;
                
                item.innerHTML = `
                    ${userHtml}
                    <span class="${record.isMe ? 'price-up' : ''}">$${record.price.toLocaleString()}</span>
                `;
                listEl.appendChild(item);
            });
        }

        // --- å…¶ä»–æ¸²æŸ“é‚è¼¯ (ä¿æŒä¸è®Š) ---
        function openDetail(carId) {
            currentDetailCar = carDatabase.find(c => c.id === carId);
            if (!currentDetailCar) return;

            document.getElementById('detail-title').innerText = currentDetailCar.title;
            document.getElementById('detail-img').src = currentDetailCar.img;
            
            const actionBtn = document.getElementById('detail-action-btn');
            const bidInfo = document.getElementById('detail-bid-info');
            const historyContainer = document.getElementById('bid-history-container');

            if (currentDetailCar.status === 'auction') {
                actionBtn.innerText = 'ç«‹å³å‡ºåƒ¹ (+1è¬)';
                bidInfo.innerText = `ç«¶æ¨™å°‡æ–¼ 23:59 çµæŸ`;
                historyContainer.style.display = 'block';
                
                // æ‰“é–‹æ™‚ï¼Œå‘¼å« updateDetailView ä¾†é¡¯ç¤ºç›®å‰å„²å­˜çš„ç´€éŒ„
                updateDetailView();
            } else {
                // å›ºå®šåƒ¹æ ¼
                document.getElementById('detail-price').innerText = `å”®åƒ¹ $${currentDetailCar.price.toLocaleString()}`;
                actionBtn.innerText = 'è¯çµ¡è³£å®¶ / ç«‹å³è³¼è²·';
                bidInfo.innerText = `åƒ¹æ ¼å›ºå®šï¼Œéš¨æ™‚å¯æˆäº¤`;
                historyContainer.style.display = 'none';
            }
            switchPage('detail');
        }

        // ... (ä»¥ä¸‹ç‚ºåŸæœ¬çš„æœå°‹ã€ç¯©é¸ã€åœ–ç‰‡é è¦½åŠŸèƒ½ï¼Œçš†ä¿æŒä¸è®Š) ...
        function createCardHTML(car) {
            const tagText = car.status === 'auction' ? 'ç«¶æ¨™ä¸­' : 'ç«‹å³è³¼è²·';
            const buttonText = car.status === 'auction' ? 'å‡ºåƒ¹' : 'è©³æƒ…/è³¼è²·';
            return `
                <article class="card" onclick="openDetail(${car.id})">
                    <div class="card-img-wrapper">
                        <img src="${car.img}" class="card-img">
                        <span class="card-tag">${tagText}</span>
                    </div>
                    <div class="card-body">
                        <h3>${car.title}</h3>
                        <div class="price-area">
                            <span class="bid-amount">${car.status === 'auction' ? 'ç¾åƒ¹' : 'å”®åƒ¹'} $${car.price.toLocaleString()}</span>
                            <button class="btn-outline">${buttonText}</button>
                        </div>
                    </div>
                </article>
            `;
        }

        function renderFeatured() {
            const grid = document.getElementById('home-featured-grid');
            const featuredCars = carDatabase.slice(0, 3);
            grid.innerHTML = featuredCars.map(createCardHTML).join('');
        }

        function applyFilters(type) {
            const isAuction = type === 'auction';
            const gridId = isAuction ? 'auction-grid' : 'buy-now-grid';
            const searchInputId = isAuction ? 'auction-search-input' : 'buy-now-search-input';
            const filterClass = isAuction ? '.brand-filter' : '.brand-filter-fixed';
            const priceName = isAuction ? 'auction-price' : 'fixed-price';
            const countId = isAuction ? 'auction-count' : 'fixed-count';
            const noResultId = isAuction ? 'auction-no-result' : 'fixed-no-result';
            
            const searchText = document.getElementById(searchInputId).value.toLowerCase();
            const checkedBrands = Array.from(document.querySelectorAll(filterClass + ':checked')).map(el => el.value);
            const priceValue = document.querySelector(`input[name="${priceName}"]:checked`).value;

            const filteredData = carDatabase.filter(car => {
                const matchType = car.status === type;
                const matchSearch = car.title.toLowerCase().includes(searchText);
                const matchBrand = checkedBrands.length === 0 || checkedBrands.includes(car.brand);
                let matchPrice = true;
                if (priceValue === 'low') matchPrice = car.price < 1000000;
                else if (priceValue === 'mid') matchPrice = car.price >= 1000000 && car.price <= 2000000;
                else if (priceValue === 'high') matchPrice = car.price > 2000000;
                return matchType && matchSearch && matchBrand && matchPrice;
            });

            const grid = document.getElementById(gridId);
            const noResult = document.getElementById(noResultId);
            const countLabel = document.getElementById(countId);
            grid.innerHTML = filteredData.map(createCardHTML).join('');
            noResult.style.display = filteredData.length === 0 ? "block" : "none";
            countLabel.innerText = `é¡¯ç¤º ${filteredData.length} ç­†`;
        }

        function switchPage(pageId) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('.nav-links a').forEach(link => link.classList.remove('active-link'));
            const navLink = document.getElementById('nav-' + pageId);
            if(navLink) navLink.classList.add('active-link');
            
            if (pageId === 'auction') applyFilters('auction');
            if (pageId === 'buy-now') applyFilters('fixed');
            if (pageId === 'home') renderFeatured();

            if (pageId === 'auction' || pageId === 'buy-now') lastViewedPage = pageId;
            window.scrollTo(0, 0);
        }

        function executeHomeSearch() {
            const keyword = document.getElementById('home-search-input').value;
            switchPage('auction'); 
            document.getElementById('auction-search-input').value = keyword;
            applyFilters('auction');
        }

        function previewImages(event) {
            const previewContainer = document.getElementById('image-preview-container');
            previewContainer.innerHTML = "";
            const files = event.target.files;
            if (files) {
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'preview-img';
                        previewContainer.appendChild(img);
                    }
                    reader.readAsDataURL(file);
                });
            }
        }
    </script>
</body>
</html>